From 8efd802180737026b441a7331b32163049051d9f Mon Sep 17 00:00:00 2001
From: AD-Aleksandrov <aleksandr.aleksandrov@emlid.com>
Date: Fri, 24 Nov 2017 12:59:57 +0300
Subject: [PATCH] arm: dts: add uart2, uart3 rts_cts pins for sunxi-h3-h5

activate these pins into overlays
---
 arch/arm/boot/dts/overlay/sun8i-h3-uart1.dts              |  2 +-
 arch/arm/boot/dts/overlay/sun8i-h3-uart2.dts              |  2 +-
 arch/arm/boot/dts/overlay/sun8i-h3-uart3.dts              |  2 +-
 arch/arm/boot/dts/sunxi-h3-h5.dtsi                        | 10 ++++++++++
 arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart1.dts |  2 +-
 arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart2.dts | 12 +-----------
 arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart3.dts | 12 +-----------
 7 files changed, 16 insertions(+), 26 deletions(-)

diff --git a/arch/arm/boot/dts/overlay/sun8i-h3-uart1.dts b/arch/arm/boot/dts/overlay/sun8i-h3-uart1.dts
index 8a4f7e4..73aeae1 100644
--- a/arch/arm/boot/dts/overlay/sun8i-h3-uart1.dts
+++ b/arch/arm/boot/dts/overlay/sun8i-h3-uart1.dts
@@ -15,7 +15,7 @@
 		target = <&uart1>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart1_pins>;
+			pinctrl-0 = <&uart1_pins>, <&uart1_rts_cts_pins>;
 			status = "okay";
 		};
 	};
diff --git a/arch/arm/boot/dts/overlay/sun8i-h3-uart2.dts b/arch/arm/boot/dts/overlay/sun8i-h3-uart2.dts
index 499a1b4..2cf4eef 100644
--- a/arch/arm/boot/dts/overlay/sun8i-h3-uart2.dts
+++ b/arch/arm/boot/dts/overlay/sun8i-h3-uart2.dts
@@ -15,7 +15,7 @@
 		target = <&uart2>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart2_pins>;
+			pinctrl-0 = <&uart2_pins>, <&uart2_rts_cts_pins>;
 			status = "okay";
 		};
 	};
diff --git a/arch/arm/boot/dts/overlay/sun8i-h3-uart3.dts b/arch/arm/boot/dts/overlay/sun8i-h3-uart3.dts
index b5734c5..a24eb90 100644
--- a/arch/arm/boot/dts/overlay/sun8i-h3-uart3.dts
+++ b/arch/arm/boot/dts/overlay/sun8i-h3-uart3.dts
@@ -15,7 +15,7 @@
 		target = <&uart3>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart3_pins>;
+			pinctrl-0 = <&uart3_pins>, <&uart3_rts_cts_pins>;
 			status = "okay";
 		};
 	};
diff --git a/arch/arm/boot/dts/sunxi-h3-h5.dtsi b/arch/arm/boot/dts/sunxi-h3-h5.dtsi
index 11240a8..710c009 100644
--- a/arch/arm/boot/dts/sunxi-h3-h5.dtsi
+++ b/arch/arm/boot/dts/sunxi-h3-h5.dtsi
@@ -377,10 +377,20 @@
 				function = "uart2";
 			};
 
+			uart2_rts_cts_pins: uart2_rts_cts {
+				pins = "PA2", "PA3";
+				function = "uart2";
+			};
+
 			uart3_pins: uart3 {
 				pins = "PA13", "PA14";
 				function = "uart3";
 			};
+
+			uart3_rts_cts_pins: uart3_rts_cts {
+				pins = "PA15", "PA16";
+				function = "uart3";
+			};
 		};
 
 		timer@01c20c00 {
diff --git a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart1.dts b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart1.dts
index 0ce76ef..7eca5ca 100644
--- a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart1.dts
+++ b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart1.dts
@@ -15,7 +15,7 @@
 		target = <&uart1>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart1_pins>;
+			pinctrl-0 = <&uart1_pins>, <&uart1_rts_cts_pins>;
 			status = "okay";
 		};
 	};
diff --git a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart2.dts b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart2.dts
index 88cc0cd..77a9119 100644
--- a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart2.dts
+++ b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart2.dts
@@ -12,20 +12,10 @@
 	};
 
 	fragment@1 {
-		target = <&pio>;
-		__overlay__ {
-			uart2_rts_cts: uart2_rts_cts {
-				pins = "PA2", "PA3";
-				function = "uart2";
-			};
-		};
-	};
-
-	fragment@2 {
 		target = <&uart2>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart2_pins>;
+			pinctrl-0 = <&uart2_pins>, <&uart2_rts_cts_pins>;
 			status = "okay";
 		};
 	};
diff --git a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart3.dts b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart3.dts
index 3ad6cc9..0badb02 100644
--- a/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart3.dts
+++ b/arch/arm64/boot/dts/allwinner/overlay/sun50i-h5-uart3.dts
@@ -12,20 +12,10 @@
 	};
 
 	fragment@1 {
-		target = <&pio>;
-		__overlay__ {
-			uart3_rts_cts: uart3_rts_cts {
-				pins = "PA15", "PA16";
-				function = "uart3";
-			};
-		};
-	};
-
-	fragment@2 {
 		target = <&uart3>;
 		 __overlay__ {
 			pinctrl-names = "default";
-			pinctrl-0 = <&uart3_pins>;
+			pinctrl-0 = <&uart3_pins>, <&uart3_rts_cts_pins>;
 			status = "okay";
 		};
 	};
-- 
2.7.4

